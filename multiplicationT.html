<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">

  <title>Klingberg Multiplikation</title>
  <meta name="description" content="A site to train multiplication">
  <meta name="Michael Morrison" content="SitePoint">
 <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style type="text/css">
{
    margin: 0;
    padding: 0;
}

body {
    background-color: black;
}


#main {
  grid-area: 1/1/2/2;
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  grid-template-rows: repeat(2, 1fr);
}

/*-----main-----*/



/*-----left------*/
#table {
  display: grid;
  grid-template-columns: repeat(10, 30px);
  grid-template-rows: repeat(10, 30px);
  justify-self: center;
  background-color: white;
}


/*-----right-----*/
#display-screen {
  grid-area: 1/1/2/7;
    border: 2px solid #550;
    background-color: gray;
}



#numberpad {
  grid-area: 2/1/7/8;
  display: grid;
  overflow: hidden;
  grid-template-columns: repeat(4, 100px) 50px 50px;
  grid-template-rows: 150px repeat(4, 100px);
  justify-self: center;
  /*grid-template-columns: repeat(4, 1fr) 0.5fr 0.5fr;
  grid-template-rows: repeat(4, 1fr);*/
}

#meter_inner {
  grid-area: 2/5/6/6;
  display: flex;
  height: 90%;
  border: 2px solid #550;
  background-color: black;
  background-image: linear-gradient(to right, gray, black, gray);
}
#meter_bar {
  flex: 1;
  align-self: flex-end;
  background-color: blue;
  background-image: linear-gradient(to right, blue, cyan, blue);
}

#timer_inner {
 grid-area: 2/6/6/7;
 display: flex;
  height: 90%;
  border: 2px solid #550;
  background-image: linear-gradient(to right, red, orange, red);
}
#timer_bar {
  display: flex;
  align-self: flex-start;
  background-color: black;
  width: 100%;
  height: 100%;
  background-image: linear-gradient(to right, gray, black, gray)
}
/*----numberpad-----*/

svg{
  display: block;
  width: 100%;
  height: 100%;
  viewBox: 0 0 100 100;
  preserveAspectRatio: none;
}

.keypad-button {
  
  background-color: gray;
}

@media screen and (orientation: portrait) {
  #table {grid-area: 1/1/2/3; margin-bottom: 2%;}
  #numberpad {grid-area: 2/1/3/3;}
}

@media screen and (orientation: landscape) {
  #table {grid-area: 1/1/2/2; margin-right: 5%;}
  #numberpad {grid-area: 1/2/2/3; margin-top: 5%;}
}

@media screen and (max-width : 500px){
  #numberpad {
    grid-template-columns: repeat(4, 64px) 32px 32px;
    grid-template-rows: 82px repeat(4, 64px);
  }
  #table {
    grid-template-columns: repeat(10, 40px);
    grid-template-rows: repeat(10, 40px);
  }
}

@media screen and (min-width: 1401px){
  #numberpad {
    grid-template-columns: repeat(4, 100px) 50px 50px;
    grid-template-rows: 120px repeat(4, 100px);
  }
}

@media screen and (min-width: 500, max-width : 1400px){
  #numberpad {
    grid-template-columns: repeat(4, 100px) 50px 50px;
    grid-template-rows: 120px repeat(4, 100px);
  }
}

  </style>

</head>

<body>
  <div id="main">
  <div id="table"></div>
    <div id="numberpad">
      <div id="display-screen">
        <svg xmlns="http://www.w3.org/2000/svg">
          <defs>
            <linearGradient id="Hope">
              <stop offset="0%" stop-color="#5f777d" stop-opacity="1"/>
              <stop offset="50%" stop-color="#b2ced5" stop-opacity="1"/>
              <stop offset="100%" stop-color="#3f484a" stop-opacity="1"/>
            </linearGradient>
            <linearGradient id="Glass">
              <stop offset="0%" stop-color="#5f777d" stop-opacity="0.3"/>
              <stop offset="50%" stop-color="#b2ced5" stop-opacity="0.4"/>
              <stop offset="100%" stop-color="#3f484a" stop-opacity="0.2"/>
            </linearGradient>
            <linearGradient id="Flat">
              <stop offset="0%" stop-color="white" stop-opacity="0.4"/>
                <stop offset="100%" stop-color="gray" stop-opacity="0.3"/>
              </linearGradient>
            </defs>
            <rect x="0" y="0" rx="2%" ry="2%" width="100%" height="100%" fill="url(#Hope)" stroke="black" stroke-width="2%"/>
            <rect x="4%" y="8%" rx="2%" ry="2%" width="44%" height="84%" fill="cyan" stroke="black" stroke-width="2%"/>
            <rect id="answer-field" x="52%" y="8%" rx="2%" ry="2%" width="44%" height="84%" fill="cyan" stroke="black" stroke-width="2%"/>
            <text id="question" x="25%" y="65%" text-anchor="middle" font-size="2em" stroke="black" fill="black">...........</text> 
            <text id="answer" x="73%" y="65%" text-anchor="middle" font-size="2em" stroke="black" fill="black">...........</text> 
            <rect x="4%" y="8%" rx="2%" ry="2%" width="44%" height="84%" fill="url(#Glass)"/>
            <rect x="52%" y="8%" rx="2%" ry="2%" width="44%" height="84%" fill="url(#Glass)"/>
            </svg>
        </div>
            <div id="meter_inner">
              <div id="meter_bar"></div>
            </div>
            <div id="timer_inner">
              <div id="timer_bar"></div>
            </div>
          
          <div id="bstart" class="keypad-button" style="grid-area:2/4/4/5;"  onclick="start('bstart')" >
            <svg xmlns="http://www.w3.org/2000/svg">
              <defs>
              <linearGradient id="Bob">
                <stop offset="0%" stop-color="white" stop-opacity="0.5"/>
                <stop offset="50%" stop-color="#242424" stop-opacity="0.2"/>
                <stop offset="100%" stop-color="white" stop-opacity="0.2"/>
              </linearGradient>
            </defs>
            <rect x="0" y="4%" rx="5%" ry="5%" width="90%" height="100%" fill="#00000037"/>
            <rect x="4%" y="2%" rx="5%" ry="5%" width="91%" height="96%" fill="#0e2b10"/>
            <rect x="8%" y="2%" rx="5%" ry="5%" width="86%" height="93%" fill="url(#Bob)"/>
              <text id="start-text" x="100%" y="-17%" text-anchor="middle" transform="rotate(90)" stroke="black" font-size="2em" fill="white">START</text> 
            </svg>
          </div>
          <div class="keypad-button" id="kbd" style="grid-area:5/1/6/2;" onclick="deleteValue('kbd')"></div>
          <div class="keypad-button" id="kb0" style="grid-area:5/2/6/3;" onclick="addValue('0', 'kb0')"></div>
          
          <div id="kbe" class="keypad-button" style="grid-area:4/3/6/5;" onclick="returnAnswer('kbe')">
            <svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 100 100" preserveAspectRatio="none" >
               <path d="M57,2 L93,2 Q98,2 98,7 L98,93 Q98,98 93,98 L7,98 Q2,98 2,93 L2,57 Q2,52 7,52 L47,52 Q52,52 52,47 L52,7 Q52,2 57,2" transform="translate(-2 2)" fill="#00000037"/>
               <path d="M57,2 L93,2 Q98,2 98,7 L98,93 Q98,98 93,98 L7,98 Q2,98 2,93 L2,57 Q2,52 7,52 L47,52 Q52,52 52,47 L52,7 Q52,2 57,2" fill="#0e2b10"/>
               <path d="M59,2 L92,2 Q97,2 97,7 L97,91 Q97,95 92,95 L9,95 Q4,95 4,90 L4,57 Q4,52 9,52 L49,52 Q55,52 55,47 L55,7 Q55,2 59,2" fill="url(#Bob)"/>
              <text id="enter" x="50" y="81" text-anchor="middle" font-size="2em" stroke="black" fill="white">enter</text>
            </svg>
          </div>
          
          <div class="keypad-button" id="kb1" style="grid-area:4/1/5/2;" onclick="addValue('1', 'kb1')"></div>
          <div class="keypad-button" id="kb2" style="grid-area:4/2/5/3;" onclick="addValue('2', 'kb2')"></div>
          <div class="keypad-button" id="kb3" style="grid-area:4/3/5/4;" onclick="addValue('3', 'kb3')"></div>
            
          <div class="keypad-button" id="kb4" style="grid-area:3/1/4/2;" onclick="addValue('4', 'kb4')"></div>
          <div class="keypad-button" id="kb5" style="grid-area:3/2/4/3;" onclick="addValue('5', 'kb5')"></div>
          <div class="keypad-button" id="kb6" style="grid-area:3/3/4/4;" onclick="addValue('6', 'kb6')"></div>
               
          <div class="keypad-button" id="kb7" style="grid-area:2/1/3/2;" onclick="addValue('7', 'kb7')"></div>
          <div class="keypad-button" id="kb8" style="grid-area:2/2/3/3;" onclick="addValue('8', 'kb8')"></div>
          <div class="keypad-button" id="kb9" style="grid-area:2/3/3/4;" onclick="addValue('9', 'kb9')"></div>
        </div>
      
    </div>
<script src="//cdn.jsdelivr.net/npm/eruda"></script>
<script>eruda.init();</script>
<script src="//cdn.jsdelivr.net/npm/eruda-dom"></script>
<script>eruda.add(erudaDom);</script>

    <script type="text/javascript">
window.store = {
    localStoreSupport : function() {
        try {
            return 'localStorage' in window && window['localStorage'] !== null;
        } catch (e) {
            return false;
        }
    },
    set : function(name,value,days) {
        if (days) {
            var date = new Date();
            date.setTime(date.getTime()+(days*24*60*60*1000));
            var expires = "; expires="+date.toGMTString();
        }
        else {
            var expires = "";
        }
        if( this.localStoreSupport() ) {
            localStorage.setItem(name, value);
        }
        else {
            document.cookie = name+"="+value+expires+"; path=/";
        }
    },
    get : function(name) {
        if( this.localStoreSupport() ) {
            return localStorage.getItem(name);
        }
        else {
            var nameEQ = name + "=";
            var ca = document.cookie.split(';');
            for(var i=0;i < ca.length;i++) {
                var c = ca[i];
                while (c.charAt(0)==' ') c = c.substring(1,c.length);
                if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length,c.length);
            }
            return null;
        }
    },
    del : function(name) {
        if( this.localStoreSupport() ) {
            localStorage.removeItem(name);
        }
        else {
            this.set(name,"",-1);
        }
    }
}
    
let toggle = false;
let stats = get_stats();
console.log('stats', stats)
let count = 45 - stats.products.length;
document.getElementById('timer_bar').style.height = (100-stats.timerHeight).toString() + '%';
let calculatedAnswer;
let table_y_axis = ['b', 'c', 'd', 'e', 'f', 'g', 'h', 'k', 'l'];
let verticalMemory = [];
let horizontalMemory = [];
let questionText = "";

let timer;

growTable();

for (let x = 0; x < 10; x ++){
  let id = 'kb' + x;
  drawButton(id)
}
drawButton('kbd')

function createSVGElement(tag) {
  return document.createElementNS('http://www.w3.org/2000/svg', tag)
}

function setAttributes (el, atts) {
    Object.entries(atts).forEach(([key, value]) => {
        el.setAttribute(key, value);
    });
};

function drawButton(id) {
  let label = id[2];
  if (label  == 'd'){
    label = 'del'
  }
  let svg = createSVGElement('svg');
  let shadow = createSVGElement('rect');
  let base = createSVGElement('rect');
  let front = createSVGElement('rect');
  let text = createSVGElement('text');
  let node = document.createTextNode(label);
  text.appendChild(node)
  setAttributes(shadow, {
   'rx' : '5%',
   'ry' : '5%',
   'x' : '0%',
   'y' : '6%',
   'width' : '90%',
   'height' : '100%',
   'fill' : '#00000037',
 });

  setAttributes(base, {
   'rx' : '5%',
   'ry' : '5%',
   'x' : '4%',
   'y' : '4%',
   'width' : '92%',
   'height' : '92%',
   'fill' : 'black',
 });
  if (id == 'kbd') {
    setAttributes(base, {
   'fill' : '#320808',
 });
  }
 setAttributes(front, {
   'rx' : '5%',
   'ry' : '5%',
   'x' : '8%',
   'y' : '4%',
   'width' : '86%',
   'height' : '86%',
   'fill' : 'url(#Bob)',
 });
 setAttributes(text, {
   'x' : '50%',
   'y' : '62%',
   'fill' : 'white',
   'stroke' : 'black',
   'text-anchor': 'middle',
   'font-size' : '2em',
 })
 svg.appendChild(shadow);
 svg.appendChild(base);
 svg.appendChild(front);
 svg.appendChild(text);
 document.getElementById(id).appendChild(svg)
}

function drawTableButton(id, use, label) {
  let svg = createSVGElement('svg');
  let base = createSVGElement('rect');
  let top = createSVGElement('rect');
  let shade = createSVGElement('rect');
  let text = createSVGElement('text');
  let node = document.createTextNode(label);
  text.appendChild(node)
  setAttributes(base, {
   'rx' : '2%',
   'ry' : '2%',
   'x' : '0%',
   'y' : '0%',
   'width' : '100%',
   'height' : '100%',
   'fill' : '#000000',
  });
 if (use == 'button') {
  setAttributes(shade, {
   'rx' : '5%',
   'ry' : '5%',
   'x' : '12%',
   'y' : '6%',
   'width' : '82%',
   'height' : '82%',
   //'fill' : '#ffffff33'
   'fill' : 'url(#Flat)',
 });
 setAttributes(top, {
   'rx' : '2%',
   'ry' : '2%',
   'x' : '4%',
   'y' : '4%',
   'width' : '93%',
   'height' : '92%',
   'fill' : '#562c19',
 });

 setAttributes(text, {
   'x' : '50%',
   'y' : '70%',
   'text-anchor': 'middle',
   'font-size': '1.5em',
   'fill' : 'black',
   'stroke': 'black',
 })} else {
setAttributes(top, {
   'rx' : '2%',
   'ry' : '2%',
   'x' : '2%',
   'y' : '2%',
   'width' : '96%',
   'height' : '96%',
   'fill' : '#7b7853',
 });
setAttributes(shade, {
   'rx' : '5%',
   'ry' : '5%',
   'x' : '6%',
   'y' : '2%',
   'width' : '90%',
   'height' : '92%',
   //'fill' : '#ffffff33'
   'fill' : 'url(#Flat)',
 });
 setAttributes(text, {
   'x' : '50%',
   'y' : '70%',
   'text-anchor': 'middle',
   'font-size': '1.3em',
   'fill' : 'black',
   'stroke' : 'black',
 })}
 svg.appendChild(base);
 svg.appendChild(top);
 svg.appendChild(shade);
 svg.appendChild(text);
 document.getElementById(id).appendChild(svg)
}


function buttonDown(id) {
  let x = 0;
  if (id == 'bstart') x = 1;
  
  let svg = document.getElementById(id).children[0];
  let shadow = svg.children[x];
  let base = svg.children[x+1];
  let front = svg.children[x+2];
  let text = svg.children[x+3];
  if (id == 'kbe') {
    setAttributes(shadow, {
    'fill': 'transparent',
  });
  setAttributes(front, {
    'd' : 'M59,3 L92,3 Q97,3 97,7 L97,93 Q97,97 92,97 L8,97 Q3,97 3,92 L3,57 Q3,53 8,53 L49,53 Q54,53 54,47 L54,7 Q54,2 59,2',
  });
  setAttributes(text, {
    'x' : '48',
   'y' : '83',
  });
  }
  if (id == 'bstart') {
    setAttributes(shadow, {
    'fill': 'transparent',
  });
  setAttributes(base, {
    'fill': 'black',
  });
  setAttributes(front, {
     'x' : '6%',
   'y' : '6%',
   'width' : '88%',
   'height' : '88%',
  });
  setAttributes(text, {
    'x' : '98%',
   'y' : '-15%',
  });
  }
  if (id !== 'bstart' && id !== 'kbe') {
  setAttributes(shadow, {
    'fill': 'transparent',
  });
  setAttributes(front, {
    'x' : '6%',
   'y' : '6%',
   'width' : '88%',
   'height' : '88%',
  });
  setAttributes(text, {
    'x' : '48%',
   'y' : '65%',
  });
}}

function buttonUp(id) {
  let svg = document.getElementById(id).children[0];
  let x = 0;
  if (id == 'bstart') x = 1;
  let shadow = svg.children[x];
  let base = svg.children[x+1];
  let front = svg.children[x+2];
  let text = svg.children[x+3];
  let color = toggle ? '#320808' : '#0e2b10';
  if (id == 'kbe') {
    setAttributes(shadow, {
    'fill': '#00000037',
  });
  setAttributes(front, {
    'd' : 'M59,2 L92,2 Q97,2 97,7 L97,91 Q97,95 92,95 L9,95 Q4,95 4,90 L4,57 Q4,52 9,52 L49,52 Q54,52 54,47 L54,7 Q54,2 59,2',
  });
  setAttributes(text, {
    'x' : '50',
   'y' : '81',
  });
  } 
  if (id == 'bstart') {
  setAttributes(shadow, {
    'fill': '#00000037',
  });
  setAttributes(base, {
    'fill': color,
  });
  setAttributes(front, {
  'x' : '8%',
   'y' : '2%',
   'width' : '86%',
   'height' : '93%',
  });
  setAttributes(text, {
    'x' : '100%',
   'y' : '-17%',
  });
  }
  if (id !== 'bstart' && id !== 'kbe'){
  setAttributes(shadow, {
    'fill': '#00000037',
  });
  setAttributes(front, {
  'x' : '8%',
   'y' : '4%',
   'width' : '86%',
   'height' : '86%',
  });
  setAttributes(text, {
    'x' : '50%',
   'y' : '62%',
  });
}}

function tableButtonsUp(className) {
  let buttons = document.getElementsByClassName(className);
  for (let i = 0; i < buttons.length; i++) {
  let svg = buttons[i].children[0];
  let shade = svg.children[2];
  let text = svg.children[3];
  setAttributes(shade, {
   'rx' : '5%',
   'ry' : '5%',
   'x' : '12%',
   'y' : '6%',
   'width' : '82%',
   'height' : '82%',
   'fill' : 'url(#Flat)',
 });
  setAttributes(text, {
   'fill': 'black',
   'stroke': 'black',
  });
  }
}

  function tableButtonDown(id) {
  let svg = document.getElementById(id).children[0];
  let shade = svg.children[2];
  let text = svg.children[3];
  setAttributes(shade, {
   'rx' : '2%',
   'ry' : '2%',
   'x' : '2%',
   'y' : '2%',
   'width' : '96%',
   'height' : '96%',
   'fill' : '#00000011'
 });
  setAttributes(text, {
   'fill': 'white',
   'stroke': 'white',
  });
  } 

function flashColor(id, colorOne, colorTwo) {
  let base = document.getElementById(id);
  setAttributes(base, {
    'fill' : colorTwo,
  })
  setTimeout(() => {
    setAttributes(base, {
      'fill' : colorOne,
    });
  }, 500)
}

function shuffle(array) {
    return array.sort(() => Math.random() - 0.5);
}

function setLevel(x) {
  level = parseInt(x);
  stats.level = level;
  changeTable();
}

function newProducts() {
    let products = [];
    for (let a = 2; a < 11; a++) {
        for (let b = a; b < 11; b++) {
            let product = a.toString() + " • " + b.toString();
            products.push(product);
        }
    }
    return products;
}


function newQuestion() {
    if (stats.products.length == 0) {
        stats.products = newProducts()
    }
    shuffle(stats.products)
    questionText = stats.products.pop();
    let ansArray = questionText.split(" • ");
    calculatedAnswer = parseInt(ansArray[0]) * parseInt(ansArray[1]);
    return questionText;
}


function replaceText(id, string) {
    let target = document.getElementById(id);
    let text = document.createTextNode(string);
    target.removeChild(target.childNodes[0]);
    target.appendChild(text);
}


function meter() {
  let meterHeight = 100*(count/45);
  //console.log('meter', meterHeight.toString() + 'px')
  document.getElementById('meter_bar').style.height = meterHeight.toString() + '%';
}

function timerStart() {
    timer = setInterval(() => {
     // console.log('theight',stats.timerHeight)
      document.getElementById('timer_bar').style.height = (100 - stats.timerHeight).toString() + '%'
      stats.timerHeight += 1;
      if (stats.timerHeight == 100) {
        if (stats.level > 1) stats.level --;
        stats.timerHeight = 0;
        document.getElementById('timer_bar').style.height = '100%';
        document.getElementById('answer').value = '';
        changeTable();
        stop('bstart')
      }
    }, 700)
}

function growTable() {
  let rows = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10];
  let table = document.getElementById('table');
    for (let i = 0; i < 10; i++) {
      let row = 11 - rows[i]
      for (let e = 0; e < 10; e++) {
        if (e == 0) {
          let input = (e + 1) * (i + 1);
          let _id = "hbtn" + i.toString();
          let functionCall = "colourHorizontal('" + _id + "')";
          let cell = document.createElement('div');
          cell.className = "horizontalButton";
          cell.id = _id;
          cell.setAttribute("onClick", "colourHorizontal(this.id)");
          cell.style.gridArea = row.toString() + '/1/' + (row+1).toString() +'/2'
          table.appendChild(cell);
          drawTableButton(_id,'button' ,input)
        } else if (i == 0) {
          let input = (e + 1) * (i + 1);
          let _id = "vbtn" + e.toString();
          let functionCall = "colourVertical('" + _id + "')";
          let cell = document.createElement('div');
          cell.className = "verticalButton";
          cell.id = _id;
          cell.setAttribute("onClick", "colourVertical(this.id)");
          cell.style.gridArea = (row).toString() + '/' + (e+1).toString() + '/'+ (row+1).toString() + '/' + (e+2).toString();
            table.appendChild(cell);
            drawTableButton(_id,'button',input)
        } else {
          let input = (e + 1) * (i + 1);
          let _id = table_y_axis[i-1] + e.toString();
          let cell = document.createElement('div');
          cell.className = "tableBody";
          cell.style.gridArea = (row).toString() + '/' + (e+1).toString() + '/' + (row+1).toString() + '/' + (e+2).toString();
          cell.id = _id;
          table.appendChild(cell);
          drawTableButton(_id,'body',input)
        }
      }
    }
    document.getElementById('hbtn0').removeAttribute("onclick");
  }


function clearTableBody(className, color) {
    let tableBodies = document.getElementsByClassName(className);
    for (let i = 0; i < tableBodies.length; i++) {
        tableBodies[i].children[0].children[1].setAttribute('fill', color);
    }
}


function colourVertical(text) {
    if (toggle) {
        tableButtonsUp('verticalButton')
        clearTableBody('tableBody', '#7b7853')
        let button = document.getElementById(text);
        tableButtonDown(text);
        let id_number = text[4];
        verticalMemory = []
        for (let i = 0; i < table_y_axis.length; i++) {
            let _id = table_y_axis[i] + id_number;
            let tableBody = document.getElementById(_id).children[0].children[1];
            verticalMemory.push(tableBody);
            tableBody.setAttribute('fill', '#ff9999');
        }
        for (let i = 0; i < horizontalMemory.length; i++) {
            horizontalMemory[i].setAttribute('fill', '#ff9999');
        }
        for (let i = 0; i < verticalMemory.length; i++) {
            for (let j = 0; j < horizontalMemory.length; j++) {
                if (verticalMemory[i] === horizontalMemory[j]) {
                    verticalMemory[i].setAttribute('fill', '#ff0000');
                  //  verticalMemory[i].style.color = "#ffffff";
                }
            }
        }
    }
}


function colourHorizontal(text) {
    if (toggle) {
      console.log('pressed horix')
        tableButtonsUp('horizontalButton')
        clearTableBody('tableBody', '#7b7853')
        let button = document.getElementById(text);
        tableButtonDown(text)
        let id_number = text[4];
        horizontalMemory = []
        for (let i = 0; i < 9; i++) {
            let _id = table_y_axis[id_number - 1] + (i + 1).toString();
            let tableBody = document.getElementById(_id).children[0].children[1];
            horizontalMemory.push(tableBody);
            tableBody.setAttribute('fill', '#ff9999');
        }
        console.log(horizontalMemory)
        for (let i = 0; i < verticalMemory.length; i++) {
            verticalMemory[i].setAttribute('fill', '#ff9999');
        }
        for (let i = 0; i < verticalMemory.length; i++) {
            for (let j = 0; j < horizontalMemory.length; j++) {
                if (verticalMemory[i] === horizontalMemory[j]) {
                    verticalMemory[i].setAttribute('fill','#ff0000');
                //    verticalMemory[i].style.color = "#ffffff";
                }
            }
        }
    }
}


function changeTable() {
    let rows = ["a", "b", "c", "d", "e", "f", "g", "h", "k", "l"];
    let max = stats.level;
    clearTableBody('tableBody', '#7b7853');
    clearTableBody('verticalButton', '#562c19');
    clearTableBody('horizontalButton', '#562c19');
    verticalMemory = [];
    horizontalMemory = [];
    for (let i = 1; i < 10; i++) {
        let row = rows[i];
        for (let e = 1; e < 10; e++) {
            let value = ((i+1) * (e +1)).toString();
            let id = row + (e).toString();
            document.getElementById(id).children[0].children[3].innerHTML = value;
        }
    }
    for (let i = 1; i < max; i++) {
        let row = rows[i];
        for (let e = 1; e < max; e++) {
            let id = row + e.toString();
            document.getElementById(id).children[0].children[3].innerHTML = ''
        }
    }
}


function start(id) {
  buttonDown(id);
  setTimeout(() => {
    buttonUp(id)
  }, 250);
    changeTable();
    let button = document.getElementById("bstart");
    let buttonText = "STOP";
    questionText = newQuestion();
    replaceText("question", questionText);
    replaceText("answer", '');
    replaceText("start-text", buttonText);
    count = 45 - stats.products.length;
    meter();
    button.setAttribute("onClick", "stop('bstart')");
    toggle = true;
    timerStart()
}


function stop(id) {
  buttonDown(id);
    setTimeout(() => {
    buttonUp(id)
    }, 250);
  console.log("stop")
    clearTableBody('tableBody', '#7b7853');
    clearTableBody('verticalButton', '#562c19');
    clearTableBody('horizontalButton', '#562c19');
    verticalMemory = [];
    horizontalMemory = [];
    stats.products.push(questionText);
    let button = document.getElementById("bstart");
    let buttonText = "START";
    questionText = "............";
    
    replaceText("question", "............");
    replaceText("answer", "............");
    replaceText("start-text", buttonText);
    button.setAttribute("onClick", "start('bstart')");
    toggle = false;
    clearInterval(timer)
    saveStats()
}


function addValue(val, id) {
  console.log(id)
  buttonDown(id);
  setTimeout(() => {
    buttonUp(id)
  }, 250);
    
  let answer = document.getElementById("answer").innerHTML;
  if (answer.includes('.')) {
    document.getElementById('answer').innerHTML = "";
  }
  document.getElementById("answer").innerHTML += val;
}


function deleteValue(id) {
  buttonDown(id);
  setTimeout(() => {
    buttonUp(id)
  }, 250);
    
    let oldString = document.getElementById("answer").innerHTML;
    let newString = oldString.slice(0, -1);
    document.getElementById("answer").innerHTML = newString;
    
}



function returnAnswer(id) {
  buttonDown(id);
  setTimeout(() => {
    buttonUp(id)
  }, 250);
        let answer = document.getElementById("answer").innerHTML;
    if (toggle) {
        if (answer) {
            intAnswer = parseInt(answer);
            if (intAnswer == calculatedAnswer) {
                flashColor('answer-field', 'cyan', '#008000');
                if (stats.products.length < 1) {
                    stats.level++;
                    changeTable();
                    stats.timerHeight = 0;
                }
                newQuestion();
                clearInterval(timer)
                stats.timerHeight -= 10;
                if (stats.timerHeight < 0) {
                  stats.timerHeight = 0;
                }
                timerStart()
                count = 45 - stats.products.length;
                meter();
                replaceText("question", questionText);
                replaceText("answer", '');
            } else {
                flashColor('answer-field', 'cyan', '#ff0000')
                stats.products.push(questionText)
                if (stats.products.length == 50) {
                    if (stats.level > 1) {
                        stats.level--;
                    }
                    else {
                        stats.level = 1;
                    }
                    changeTable();
                    stats.products = newProducts();
                    stats.timerHeight = 0;
                    count = 45 - stats.products.length
                }
                meter();
                document.getElementById("answer").innerHTML = "";
            }
        }
        else {
          console.log('else')
        }
    } else {
      if (answer.length == 3) {
      if (answer == '911') {
        clearStats()
      }
      console.log(answer.slice(0,1))
      if (answer.slice(0,2) == '77') {
        console.log(answer)
        stats.level = parseInt(answer[2]);
        changeTable();
      }
      //document.getElementById("answer").innerHTML = "";
      replaceText('answer', '')
    }
  }
}


function saveStats() {
    let text = JSON.stringify(stats);
    console.log('to save', text)
    store.set('savedStats', text)
}

function get_stats() {
    let statsText = store.get('savedStats');
    console.log(statsText)
    if (!statsText){
      statsText = '{"products":[],"product":"","level":1, "timerHeight": 0}'
    console.log('not returned stats', statsText)
    }
    let stats = JSON.parse(statsText);
    console.log('returned stats', stats)
    return stats
}

function clearStats() {
  stats = {"products":[],"product":"","level":1, "timerHeight": 0};
  store.del('savedStats');
  location.reload()
 return 0
}

</script>
</body>
</html>
