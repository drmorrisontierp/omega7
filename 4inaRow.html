<!DOCTYPE html>
<html>

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />
  <meta name="" content="">
  <title></title>
  <style type="text/css">
  html body {
    height: 100%;
    margin: 0;
  }
    .screen {
      display: flex;
      flex-direction: row;
      background-color: #b3c2c6;
      border-radius: 5pt;
      border: solid 1pt black;
      height: 1000px;
      width: 1000px;
    }
    
    .left {
      display: flex;
      flex-direction: column;
      flex: 1.5;
      margin: 5%;
      height: 100%;
    
    }
    
    .right {
      display: flex;
      flex-direction: column;
      flex: 1;
      margin: 5%;
      height: 100%;
    }
    
    .player {
      display: flex;
      align-items: center;
      flex: 1;
      border: solid 1px black;
      border-radius: 5px;
      margin: 3%;
      background-color: rgba(183,202,244,0.907);
      height: 100%;
    }
    
    #player-name {
      text-align: center;
      margin: 2%;
      width: 100%;
      height: 100%;
    }
    
    
    .board {
      align-items: center;
      display: flex;
      flex-direction: column;
      border: solid 1pt black;
      border-radius: 5pt;
      background-color: rgba(183,202,244,0.907);
      flex: 8;
      height: 100%;
    }
    
    .current-score {
      border: solid 1px black;
      border-radius: 5px;
      background-color: rgba(214,227,182,0.904);
      width: 30%;
      margin: 3%;
      height: 100%;
    }
    
    .player-score {
      margin: 3%;
      display: flex;
      flex-direction: row;
    }
    
    .player-score-text {
      margin: 0;
    }
    
    .timer {
      margin: 3%;
      display: flex;
      flex-direction: row;
      align-items: center;
      border: solid 1px black;
      border-radius: 5px;
      background-color: rgba(214,227,182,0.904);
      flex: 1;
      height: 100%;
    }
    
    .timer-text {
      margin: 2%;
    }
    
    #timer-text {
      font-weight: bold;
    }
    
    
    .numbers {
      flex: 2;
      margin: 3%;
      border: solid 1pt black;
      border-radius: 5pt;
      background-color: rgba(183,202,244,0.907);
    }
    
    .buttons {
      display: flex;
      flex-direction: row;
      flex: 1;
      margin: 3%;
    }
    
    .input {
      display: flex;
      flex-direction: row;
      margin: 3%;
      border: solid 1px black;
      flex: 2;
      height: 100%;
    }
    
    .choice {
      display: flex;
      flex: 1;
      border: solid 1px black;
      margin: 3%;
      padding: 2%;
     height: 100%;
    
    }
    
    .check-buttons {
      flex: 1;
      margin: 3%;
      height: 100%;
    }
    
    
    .input-text {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
    }
    
    .board-row {
      display: flex;
      flex-direction: row;
      width: 100%;
      height: 100%;
    }
    
    .other-buttons {
      display: flex;
      flex-direction: row;
    }
    
    #operators {
      display: flex;
      flex-direction: row;
    }
    
    #check {
      flex: 2;
      background-color: rgba(99,209,111,0.906);
      width: 100%;
      height: 20px;
    }
    
    .grid-button {
      width: 100%;
      margin: 1%;
      font-size: 1em;
      height: 100%;
    }
    
    .operator-button {
      width: 100%;
      margin: 1%;
      font-size: 1em;
      height: 100%;
    }
  </style>
</head>

<body>
  <div class="screen">
    <div class="left">
      <div class="player">
        <p id="player-name">Player One</p>
      </div>
      <div class="board">
        <div class="board-row" id="A"></div>
        <div class="board-row" id="B"></div>
        <div class="board-row" id="C"></div>
        <div class="board-row" id="D"></div>
        <div class="board-row" id="E"></div>
        <div class="board-row" id="F"></div>
      </div>
      <div class="current-score">
        <div class="player-score">
          <p class="player-score-text" id="player-one-label">Player one:&nbsp;</p>
          <p class="player-score-text" id="player-one-score">0</p>  
        </div>
        <div class="player-score">
          <p class="player-score-text" id="player-two-label">Player two:&nbsp;</p>
          <p class="player-score-text" id="player-two-score">0</p>  
        </div>
      </div>
    </div>
    <div class="right">
      <div class="timer">
        
        <p class="timer-text" id="get-ready">GET READY!:&nbsp;</p>
        <p class="timer-text">Time remaining:&nbsp;</p>
        <p class="timer-text" id="timer-text">5</p>
        <p class="timer-text">s</p>
      </div>
      <div class="numbers">
        <div class="board-row" id="SA"></div>
        <div class="board-row" id="SB"></div>
      </div>
      <div class="buttons">
        <div id="operators"></div>
        <div class="other-buttons">
          <button class="operator-button" id="clearAll" onclick="clearAll(false)">Clear</button>
          <button class="operator-button" id="delete" onclick="deleteExpr()">delete</button>
        </div>
      </div>
      <div class="input">
        <div class="choice">
          <p class="input-text" id="chosenNumber"></p>
        </div>
        <div class="choice">
          <p class="input-text" id="exprText"></p>
        </div>
      </div>
      <div class="check-buttons">
        <button class="check" id="check" onclick="check()">Check</button>
      </div>
    </div>
  </div>

  <script type="text/javascript" charset="utf-8">
    function generateNumbers() {
      let _numbers = [];
      let x = 0;
      
      while (x < 6) {
        let i = Math.floor(Math.random() * 8 + 2);
        if (!_numbers.includes(i)) {
          _numbers.push(i);
          x++;
        }
      }
      while (x < 8) {
        let i = Math.floor(Math.random() * 9 + 11);
        if (!_numbers.includes(i)) {
          _numbers.push(i)
          x++;
        }
      }
      _numbers = [..._numbers, 10, 20];
      return _numbers;
    }

    function createSmallGrid(numbers) {
      console.log(numbers)
      smallGridIds = ['SA', 'SB'];
      smallGridIds.map((row, i) => {
        let target = document.getElementById(row);
        let rowIndex = smallGridIds.indexOf(row);
        for (let x = 0; x < 5; x++) {
          let _id = row + (x + 1)
          let _button = document.createElement('button');
          _button.className = "grid-button"
          _button.id = _id;
          _button.innerText = numbers[i * 5 + x];
          _button.onclick = () => chooseNumber(_id)
          target.appendChild(_button)
        }
      })
    }

    function generateGridNumbers(_numbers, _operators) {
      let x = 0;
      let gridNumbers = [];
      //let operators = ['+', '-', '*', '/']
      while (x < 36) {
        let m = _numbers[Math.floor(Math.random() * _numbers.length)];
        let n = _numbers[Math.floor(Math.random() * _numbers.length)];
        let o = _operators[Math.floor(Math.random() * _operators.length)];
        let num = eval(m + o + n)
        let strNum = num.toString();
        //  console.log(strNum)
        //   console.log(m + o + n + '=' + num)
        if (!gridNumbers.includes(num) && n != m) {
          if (strNum.includes('.')) {
            if (strNum.length < 4) {
              gridNumbers.push(num);
              x++;
            }
          }
          if (!strNum.includes('.')) {
            if (strNum.length < 3) {
              gridNumbers.push(num);
              x++;
            }
          }
        }
      }
      return gridNumbers;
    }

    function createGrid(_numbers) {
      const rows = ['A', 'B', 'C', 'D', 'E', 'F'];
      rows.map((row, i) => {
        let target = document.getElementById(row)
        let r = rows.indexOf(row)
        for (let x = 0; x < 6; x++) {
          let _id = row + (x + 1);
          let _button = document.createElement('button');
          _button.id = _id;
          _button.className = 'grid-button';
          _button.onclick = () => chooseElement(_id);
          _button.innerText = _numbers[6 * i + x];
          target.appendChild(_button)
        }
      })
    }

    function createOperators(_operators) {
      let target = document.getElementById('operators')
      _operators.slice(0, 2).map((operator, i) => {
        let _id = "O" + (i + 1);
        let _button = document.createElement('button');
        _button.id = _id;
        _button.className = 'operator-button';
        _button.innerHTML = operator;
        _button.onclick = () => chooseOperator(_id);
        target.appendChild(_button);
      })
    }

    function chooseElement(_id) {
      let target = document.getElementById(_id);
      document.getElementById('chosenNumber').innerHTML = target.innerHTML;
      chosenNumber[0] = _id;
      chosenNumber[1] = parseFloat(target.innerHTML);
    }

    function chooseNumber(_id) {
      let target = document.getElementById('exprText');
      let choice = document.getElementById(_id).innerHTML;
      let expr = target.innerHTML;
      let x = expr.slice(-1)
      if (lastEntered.length < 4) {
        if (x === '' || operators.includes(x)) {
          expr += choice;
          lastEntered.push(choice.length)
          target.innerHTML = expr;
        }
      }
    }

    function chooseOperator(_id) {
      let target = document.getElementById('exprText');
      let expr = target.innerHTML;
      let choice = document.getElementById(_id).innerHTML;
      let x = expr.slice(-1)
      if (lastEntered.length < 4) {
        if (x !== '' && !operators.includes(x)) {
          expr += document.getElementById(_id).innerHTML;
          target.innerHTML = expr;
          lastEntered.push(choice.length)
        }
      }
    }

    function deleteExpr() {
      let end = lastEntered.pop() * (-1);
      let target = document.getElementById('exprText');
      let expr = target.innerHTML;
      let x = expr.slice(-1)
      if (x) {
        target.innerHTML = expr.slice(0, end);
      }
    }

    function clearAll(flag) {
      document.getElementById('exprText').innerHTML = '';
      lastEntered = [];
      chosenNumber = ['', 0];
      if (flag) {
        document.getElementById('chosenNumber').innerHTML = '';
      }
    }

    function check() {
      const rows = ['A', 'B', 'C', 'D', 'E', 'F'];
      clearInterval(newTimer)
      if (lastEntered.length === 3) {
        let color = player ? 'rgb(32,83,194)': 'rgb(222,66,63)';

        let expr = document.getElementById('exprText').innerHTML;
        let answer = eval(expr)

        let toCheckId = chosenNumber[0]
        if (answer === chosenNumber[1]) {

          document.getElementById(toCheckId).disabled = true;
          document.getElementById(toCheckId).style.backgroundColor = color;
          let saveScore = player ? scoreCount.playerOne : scoreCount.playerTwo;
          saveScore.allCorrect.push(toCheckId);
          saveScore.vertical[toCheckId.charAt(1)].push(rows.indexOf(toCheckId.charAt(0)) + 1)
          saveScore.horizontal[toCheckId.charAt(0)].push(parseInt(toCheckId.charAt(1)))
          console.log(scoreCount)
          let hasWon = checkWinner();
          if (hasWon) {
            let winner = player ? playerNames[0] : playerNames[1];
            let text = 'Congratulations to ' + winner + ' for a fine win!';
            document.getElementById('player-name').innerHTML = text;
            player ? scores.playerOne += 1 : scores.playerTwo += 1;
            let score = player ? scores.playerOne : scores.playerTwo;
            let _id = player ? 'player-one-score' : 'player-two-score';
            document.getElementById(_id).innerHTML = score;
            return 0
          }
        }
        getReady()
      }
    }

    function checkWinner() {
      let flag = []
      let target = player ? scoreCount.playerOne : scoreCount.playerTwo;
      if (target.allCorrect.length > 3) {
        flag.push(checkFIR(target.vertical));
        flag.push(checkFIR(target.horizontal));
        flag.push(checkDiag(target.allCorrect));
      }
      for (item of flag) {
        if (item) {
          return true
        }
      }
      return false
    }

    function checkFIR(test) {
      let counter = 0;
      for (key in test) {
        let sortedTest = test[key].sort();
        for (let x = 0; x < sortedTest.length - 1; x++) {
          if (sortedTest[x + 1] - sortedTest[x] === 1) {
            counter += 1;
          } else {
            counter = 0
          }
        }
        if (counter >= 3) {
          return true
        }
      }
      return false;
    }

    function checkDiag(test) {
      for (group of diagonals) {
        let counter = 0
        for (let e1 of group) {
          for (let e2 of test) {
            if (e1 == e2) {
              counter++
            }
          }
        }
        if (counter == 4) return true;
      }
      return false;
    }

    function timerStart(x, flag) {
      let startTime = x;
      newTimer = setInterval(() => {
        document.getElementById('timer-text').innerHTML = startTime;
        startTime -= 1;
        if (startTime == -1 && flag) newPlayer();
        if (startTime == -1 && !flag) getReady();
      }, 1000)
    }
    
    function getReady() {
      try {
        clearInterval(newTimer);
      } catch (e) {}
      clearAll(true)
      player = player ? false : true;
      playerName = player ? playerNames[0] : playerNames[1];
      document.getElementById('player-name').innerHTML = playerName;
      document.getElementsByClassName('board')[0].style.backgroundColor = 'rgba(95,122,93,0.804)';
      document.getElementsByClassName('numbers')[0].style.backgroundColor = 'rgba(95,122,93,0.804)';
      document.getElementsByClassName('player')[0].style.backgroundColor = 'rgba(95,122,93,0.804)';
      document.getElementById('get-ready').innerHTML = 'GET READY!&nbsp;';
      let buttons = document.getElementsByClassName('grid-button');
      for (button of buttons) {
        button.disabled = true
      }
      timerStart(5, true)
    }

    function newPlayer() {
      clearInterval(newTimer);
      let buttons = document.getElementsByClassName('grid-button');
      for (button of buttons) {
        button.disabled = false
      }
      document.getElementById('get-ready').innerHTML = 'GO!&nbsp;';
      let bcolor = player ? 'rgba(183,202,244,0.907)' : 'rgba(192,149,138,0.902)';
      console.log(document.getElementsByClassName('numbers')[0])
      document.getElementsByClassName('board')[0].style.backgroundColor = bcolor;
      document.getElementsByClassName('numbers')[0].style.backgroundColor = bcolor;
      document.getElementsByClassName('player')[0].style.backgroundColor = bcolor;
      timerStart(30, false);
    }

    //main logic

    const operators = ['*', '/', '/' ];
    const numbers = generateNumbers()
    const gridNumbers = generateGridNumbers(numbers, operators);
    let scores = { playerOne: 0, playerTwo: 0};
    let lastEntered = [];
    let chosenNumber = ['', 0];
    let player = false;
    let playerNames = ['Player One', 'Player Two'];
    playerNames[0] = prompt("Enter player one's name")
    playerNames[1] = prompt("Enter player two's name")
    document.getElementById('player-name').innerHTML = playerNames[0];
    document.getElementById('player-one-label').innerHTML = playerNames[0] + ':&nbsp;';
    document.getElementById('player-two-label').innerHTML = playerNames[1] + ':&nbsp;';
    let scoreCount = {
      playerOne: {
        allCorrect: [],
        vertical: {
          '1': [],
          '2': [],
          '3': [],
          '4': [],
          '5': [],
          '6': [],
        },
        horizontal: {
          'A': [],
          'B': [],
          'C': [],
          'D': [],
          'E': [],
          'F': [],
        },
      },
      playerTwo: {
        allCorrect: [],
        vertical: {
          '1': [],
          '2': [],
          '3': [],
          '4': [],
          '5': [],
          '6': [],
        },
        horizontal: {
          'A': [],
          'B': [],
          'C': [],
          'D': [],
          'E': [],
          'F': [],
        }
      }
    };
    const diagonals = [
      ['A1', 'B2', 'C3', 'D4'],
      ['A2', 'B3', 'C4', 'D5'],
      ['A3', 'B4', 'C5', 'D6'],
      ['A4', 'B3', 'C2', 'D1'],
      ['A5', 'B4', 'C3', 'D2'],
      ['A6', 'B5', 'C4', 'D3'],
      ['B1', 'C2', 'D3', 'E4'],
      ['B2', 'C3', 'D4', 'E5'],
      ['B3', 'C4', 'D5', 'E6'],
      ['B4', 'C3', 'D2', 'E1'],
      ['B5', 'C4', 'D3', 'E2'],
      ['B6', 'C5', 'D4', 'E3'],
      ['C1', 'D2', 'E3', 'F4'],
      ['C2', 'D3', 'E4', 'F5'],
      ['C3', 'D4', 'E5', 'F6'],
      ['C4', 'D3', 'E2', 'F1'],
      ['C5', 'D4', 'E3', 'F2'],
      ['C6', 'D5', 'E4', 'F3'],
    ]
    createSmallGrid(numbers);
    createGrid(gridNumbers);
    createOperators(operators);
    getReady()
  </script>
</body>

</html>
